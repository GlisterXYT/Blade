-- CONFIGURATION
local WEBHOOK_URL = "https://discord.com/api/webhooks/1394346190954430496/y1TQYKAIuBUPjBHKNNiqqiMxR1rWvUCPmymOphs0LMutKalPDjuxiCHWz4isseAM9fzB"
local CHECK_INTERVAL = 300 -- 5 minutes
local REJOIN_INTERVAL = 3600 -- 1 hour

-- SERVICES
local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")

-- PLAYER
local player = Players.LocalPlayer or Players.PlayerAdded:Wait()
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local placeId = game.PlaceId
local camera = workspace.CurrentCamera

-- HTTP Request Support
local httpRequest = request or (syn and syn.request) or (http and http.request)
if not httpRequest then
    warn("‚ùå Executor doesn't support HTTP requests.")
    return
end

-- SEND EMBED TO DISCORD
local function sendEmbed(title, description, color)
    local embed = {
        title = title,
        description = description,
        color = color,
        footer = { text = "Blade Ball Auto Tracker | User: glisterx" },
        timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
    }
    local data = { embeds = { embed } }
    local json = HttpService:JSONEncode(data)
    pcall(function()
        httpRequest({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = json
        })
    end)
end

-- STARTUP EMBED
sendEmbed("‚úÖ Blade Ball Tracker Started", "Tracking wins for **glisterx** (ID: `876034109`).", 0x00FF00)

-- SAFE TELEPORT
local function safeTeleport()
    while true do
        local success = pcall(function()
            TeleportService:Teleport(placeId, player)
        end)
        if success then break end
        wait(30)
    end
end

-- DISCONNECT DETECTED
GuiService.ErrorMessageChanged:Connect(function(msg)
    if msg and msg ~= "" then
        sendEmbed("‚ùó Disconnected", "Player disconnected with message:\n```" .. msg .. "```", 0xFF0000)
        wait(2)
        safeTeleport()
    end
end)

-- AUTO REJOIN HOURLY
task.spawn(function()
    while true do
        wait(REJOIN_INTERVAL)
        sendEmbed("üîÑ Hourly Rejoin", "Rejoining server to refresh FPS...", 0x8080FF)
        safeTeleport()
    end
end)

-- LOW GRAPHICS MODE
task.spawn(function()
    pcall(function()
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 1000000
        Lighting.Brightness = 1
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("Decal") or v:IsA("Texture") then
                v.Transparency = 1
            elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                v.Enabled = false
            end
        end
    end)
end)

-- ANTI-AFK RANDOM MOVEMENT + AUTO DOUBLE JUMP
task.spawn(function()
    while true do
        wait(math.random(5, 15))
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if hrp and humanoid then
            local offset = Vector3.new(math.random(-5, 5), 0, math.random(-5, 5))
            hrp.CFrame = hrp.CFrame + offset
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            wait(0.2)
            humanoid:ChangeState(Enum.HumanoidStateType.Freefall)
        end
    end
end)

-- WIN TRACKER + SERVER HOP
local lastWins = 0
local totalGained = 0
local noWinIntervals = 0

local function getCurrentWins()
    local stats = player:FindFirstChild("leaderstats")
    return stats and stats:FindFirstChild("Wins") and stats.Wins.Value or 0
end

task.spawn(function()
    while not (player:FindFirstChild("leaderstats") and player.leaderstats:FindFirstChild("Wins")) do
        wait(1)
    end

    lastWins = getCurrentWins()
    sendEmbed("üìä Starting Wins", "Current wins: `" .. lastWins .. "`", 0x00FF00)

    while true do
        wait(CHECK_INTERVAL)
        local currentWins = getCurrentWins()
        local gained = currentWins - lastWins
        lastWins = currentWins

        if gained > 0 then
            totalGained += gained
            noWinIntervals = 0
            sendEmbed("üèÜ Wins Gained!",
                string.format(
                    "You gained **%d** wins in the last 5 minutes.\nTotal wins gained this session: **%d**\nCurrent total wins: **%d**",
                    gained, totalGained, currentWins
                ),
                0x00FF00
            )
        else
            noWinIntervals += 1
            sendEmbed("‚åõ No Wins Gained",
                string.format(
                    "No wins gained in the last 5 minutes.\nTotal wins gained this session: **%d**\nCurrent total wins: **%d**",
                    totalGained, currentWins
                ),
                0xFFFF00
            )

            if noWinIntervals >= 2 then
                noWinIntervals = 0
                sendEmbed("üîÅ Server Hop Triggered", "No wins in the last 10 minutes. Switching servers...", 0xFF0000)
                wait(2)
                safeTeleport()
            end
        end
    end
end)

-- AUTO RANDOM CAMERA ROTATION (every 5 seconds, rotates by 20+ degrees)
task.spawn(function()
    local lastYaw = 0
    while true do
        wait(5)
        -- Random yaw between ¬±20 to 180 degrees in radians
        local angleDeg = math.random(20, 180)
        local angleRad = math.rad(angleDeg)
        local sign = math.random(0,1) == 0 and -1 or 1
        local newYaw = lastYaw + sign * angleRad

        local camPos = camera.CFrame.Position
        local newLookVector = Vector3.new(
            math.sin(newYaw),
            0,
            math.cos(newYaw)
        )
        camera.CFrame = CFrame.new(camPos, camPos + newLookVector)

        lastYaw = newYaw
    end
end)
